<!doctype html>
<html lang="es">
    <head>
        <meta charset="UTF-8" />
        <title>Task App - Monolito</title>

        <style>
            body {
                font-family: Arial, sans-serif;
                background: #f4f4f4;
                padding: 20px;
            }

            h1 {
                text-align: center;
            }

            #task-form {
                display: flex;
                gap: 10px;
                margin-bottom: 20px;
            }

            input {
                flex: 1;
                padding: 8px;
            }

            button {
                padding: 8px 12px;
                cursor: pointer;
            }

            ul {
                list-style: none;
                padding: 0;
            }

            li {
                background: #fff;
                margin-bottom: 8px;
                padding: 10px;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            .completed {
                text-decoration: line-through;
                color: gray;
            }
        </style>
    </head>

    <body>
        <h1>Task App</h1>

        <form id="task-form">
            <input id="task-input" placeholder="Nueva tarea..." />
            <button>Agregar</button>
        </form>

        <button id="load-api">Cargar tareas desde API</button>

        <ul id="task-list"></ul>

        <script>
            let tasks = [];

            function saveTasks() {
                localStorage.setItem("tasks", JSON.stringify(tasks));
            }

            function loadTasks() {
                const data = localStorage.getItem("tasks");
                if (data) {
                    tasks = JSON.parse(data);
                }
            }

            const form = document.getElementById("task-form");
            const input = document.getElementById("task-input");
            const list = document.getElementById("task-list");
            const apiButton = document.getElementById("load-api");

            function renderTasks() {
                list.innerHTML = "";

                tasks.forEach((task, index) => {
                    const li = document.createElement("li");
                    li.textContent = task.title;

                    if (task.completed) {
                        li.classList.add("completed");
                    }

                    li.addEventListener("click", () => {
                        task.completed = !task.completed;
                        saveTasks();
                        renderTasks();
                    });

                    const deleteBtn = document.createElement("button");
                    deleteBtn.textContent = "X";

                    deleteBtn.addEventListener("click", (e) => {
                        e.stopPropagation();
                        tasks.splice(index, 1);
                        saveTasks();
                        renderTasks();
                    });

                    li.appendChild(deleteBtn);
                    list.appendChild(li);
                });
            }

            /*********************
             * EVENTOS ðŸ˜¬
             *********************/
            form.addEventListener("submit", (e) => {
                e.preventDefault();

                const value = input.value.trim();
                if (!value) return;

                tasks.push({
                    title: value,
                    completed: false,
                });

                input.value = "";
                saveTasks();
                renderTasks();
            });

            apiButton.addEventListener("click", async () => {
                try {
                    const response = await fetch(
                        "https://jsonplaceholder.typicode.com/todos?_limit=5",
                    );

                    const data = await response.json();

                    // Promesa innecesaria a propÃ³sito ðŸ˜ˆ
                    new Promise((resolve) => {
                        setTimeout(() => resolve(data), 1000);
                    }).then((apiTasks) => {
                        apiTasks.forEach((t) => {
                            tasks.push({
                                title: t.title,
                                completed: t.completed,
                            });
                        });

                        saveTasks();
                        renderTasks();
                    });
                } catch (error) {
                    alert("Error cargando tareas");
                }
            });

            /*********************
             * INICIALIZACIÃ“N ðŸ˜¬
             *********************/
            loadTasks();
            renderTasks();
        </script>
    </body>
</html>
